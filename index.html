<html>
   <head>
      <title>Soutěžomat: nejlepší soutěže</title>
      <link rel="icon" type="image/png" href="Ikony/Favicon.png">
      <link rel="stylesheet" href="css.css">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="description" content="Soutěžomat: nejlepší soutěže">
      <meta property="og:title" content="Zahrajte si hada...">
      <meta property="og:description" content="Hra o dárkový poukaz 1 000 Kč na Alza.cz">
      <meta property="og:image" content="https://soutezomat.cz/Ikony/Facebook3.png" />
      <meta property="og:image:type" content="image/png" />
      <meta property="og:image:width" content="1200" />
      <meta property="og:image:height" content="630" />
   </head>
   <body>
      <div class="stranka">
         <header>
            <a href="https://soutezomat.cz/" class="logo"><img src="Ikony/Logo.svg" class="logo_svg"></a>
            <a href="https://soutezomat.cz/" class="logo_ikona"><img src="Ikony/Logo-ikona.svg" class="logo_svg"></a>
         </header>
         <main>
            <div class="souteze">
               <div class="game-container">
                  <div class="score">Skóre: <span id="score">70</span></div>
                  <div class="hra_box">
                     <canvas id="gameCanvas" width="400" height="400"></canvas>
                     <div class="game-over" id="gameOver">
                        <p>Vaše skóre: <b id="finalScore">0</b></p>
                        <div id="krok1">
                           <div class="tlacitko_facebook_kontejner">
                              <span class="krok_cislo">1. krok</span>
                              <!-- Tlačítko pro sdílení na Facebooku -->
                              <button id="btnFbShare" onclick="zobrazitKrok2(); sdiletNaFacebook();">Sdílet na Facebooku</button>
                           </div>
                           <div id="hrat_znovu_vlozeni"></div>
                           <!-- Box: Hrajeme o dárkový poukaz -->
                           <div class="hrajeme_o">
                              Hra o dárkový poukaz<br>1 000 Kč
                              <div class="hrajeme_o_alza_logo">
                                 <img src="Ikony/Alza logo.svg">
                              </div>
                           </div>
                        </div>
                        <div id="krok2">
                           <!-- Skryté pole a tlačítko 1c -->
                           <input type="text" id="inputField" placeholder="Váš e-mail">
                           <button class="start-btn save_email" onclick="zobrazitKrok3()">Uložit</button>
                           <!-- Box: Hrajeme o dárkový poukaz -->
                           <div class="hrajeme_o">
                              Hra o dárkový poukaz<br>1 000 Kč
                              <div class="hrajeme_o_alza_logo">
                                 <img src="Ikony/Alza logo.svg">
                              </div>
                           </div>
                        </div>
                        <div id="krok3">
                           <button class="start-btn" onclick="restartGame(); zobrazitKrok1(); uprava_Krok1();">Hrát znovu</button>
                           <!-- Box: Hrajeme o dárkový poukaz -->
                           <div class="hrajeme_o">
                              Hra o dárkový poukaz<br>1 000 Kč
                              <div class="hrajeme_o_alza_logo">
                                 <img src="Ikony/Alza logo.svg">
                              </div>
                           </div>
                        </div>
                     </div>
                     <!-- Úvodní overlay -->
                     <div class="start-overlay" id="startOverlay" style="display: none;">
                        <div class="start-overlay_center">
                           <div class="start-overlay_center_2">
                              <div class="start-overlay_center_3"><img src="Ikony/Had.svg"></div>
                              <!-- <div class="instrukce-pc"><b>Stiskněte</b> libovolnou <b>šipku</b> na klávesnici</div> -->
                           </div>
                           <button class="start-btn" onclick="startGameMobile()">Začít hru</button>
                           <!-- Box: Hrajeme o dárkový poukaz -->
                           <div class="hrajeme_o">
                              Hra o dárkový poukaz<br>1 000 Kč
                              <div class="hrajeme_o_alza_logo">
                                 <img src="Ikony/Alza logo.svg">
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="kde_soutezime" id="kde_soutezime" style="">
               <div class="kde_soutezime_odkazy">
                  <a href="https://www.facebook.com/Soutezomat" class="odkaz-ss" target="_blank">
                     <div class="odkaz-ss-center"><img src="Ikony/Facebook.svg" class="odkaz-ss-yt" style="
                        ">
                     </div>
                  </a>
               </div>
            </div>
      </div>
      </main>
      <footer>
      </footer>
      </div>
   </body>
</html>
<script>
function uprava_Krok1() {
    // Vloží tlačítko „Hrát znovu“ do krok1, pokud tam ještě není
    const krok1 = document.getElementById("hrat_znovu_vlozeni");
    if (!document.getElementById("restart-btn")) {
        const btn = document.createElement("button");
        btn.textContent = "Hrát znovu";
        btn.className = "start-btn";
        btn.id = "restart-btn";
        btn.onclick = function() {
            restartGame();
            zobrazitKrok1();
        };
        krok1.appendChild(btn);
    }

    const prvek = document.querySelector(".krok_cislo");
    if (prvek) {
        prvek.remove();
    }
    document.querySelector(".tlacitko_facebook_kontejner").style.width = "224px";

}


function zobrazitKrok2() {
    const krok2UzZobrazen = localStorage.getItem("krok2Kliknut");

    if (krok2UzZobrazen === "true") {
        document.getElementById("krok1").style.display = "none";
        document.getElementById("krok3").style.display = "block";
    } else {
        document.getElementById("krok1").style.display = "none";
        document.getElementById("krok2").style.display = "block";
    }
}



function zobrazitKrok3() {
    document.getElementById("krok2").style.display = "none";
    document.getElementById("krok3").style.display = "block";
    localStorage.setItem("krok2Kliknut", "true");
}

function zobrazitKrok1() {
    document.getElementById("krok3").style.display = "none";
    document.getElementById("krok1").style.display = "block";
}

// Při načtení stránky můžeme rovnou podle localStorage rozhodnout
window.onload = function() {
    const krok2UzZobrazen = localStorage.getItem("krok2Kliknut");

    if (krok2UzZobrazen === "true") {
        document.getElementById("krok1").style.display = "block";
        document.getElementById("krok2").style.display = "none";
    }
};

function sdiletNaFacebook() {
    const url = encodeURIComponent(window.location.href);
    const facebookShareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
    window.open(facebookShareUrl, '_blank');
}
</script>

<script>
   const canvas = document.getElementById('gameCanvas');
   const ctx = canvas.getContext('2d');
   const scoreElement = document.getElementById('score');
   const gameOverElement = document.getElementById('gameOver');
   const finalScoreElement = document.getElementById('finalScore');
   const startOverlayElement = document.getElementById('startOverlay');

   // Herní proměnné
   const gridSize = 20;
   const tileCount = canvas.width / gridSize;

   let snake = [{
       x: Math.floor(tileCount / 2),
       y: Math.floor(tileCount / 2)
   }];
   let food = {};
   let dx = 0;
   let dy = 0;
   let score = 0;
   let gameRunning = false; // Hra začne pozastavená
   let gameStarted = false; // Sleduje, zda hra začala

   // Proměnné pro detekci dotyku
   let touchStartX = 0;
   let touchStartY = 0;
   let touchEndX = 0;
   let touchEndY = 0;
   let minSwipeDistance = 30; // Minimální vzdálenost pro detekci swipe

   // Fronta příkazů pro plynulejší ovládání
   let inputQueue = [];

   // Inicializace hry
   function init() {
       generateFood();
       draw(); // Jen vykreslí, nespustí smyčku
       startOverlayElement.style.display = 'block'; // Zobrazí overlay
   }

   // Generování jídla
   function generateFood() {
       food = {
           x: Math.floor(Math.random() * tileCount),
           y: Math.floor(Math.random() * tileCount)
       };

       // Ujistit se, že jídlo není na hadovi
       for (let segment of snake) {
           if (segment.x === food.x && segment.y === food.y) {
               generateFood();
               return;
           }
       }
   }

   // Vykreslení hry
   function draw() {
       // Vyčištění plátna
       ctx.fillStyle = '#ffffff';
       ctx.fillRect(0, 0, canvas.width, canvas.height);

       // Vykreslení mřížky
       ctx.strokeStyle = '#e0e0e0';
       ctx.lineWidth = 1;
       for (let i = 0; i <= tileCount; i++) {
           ctx.beginPath();
           ctx.moveTo(i * gridSize, 0);
           ctx.lineTo(i * gridSize, canvas.height);
           ctx.stroke();

           ctx.beginPath();
           ctx.moveTo(0, i * gridSize);
           ctx.lineTo(canvas.width, i * gridSize);
           ctx.stroke();
       }

       // Vykreslení hada
       for (let i = 0; i < snake.length; i++) {
           const segment = snake[i];

           // Hlava hada je světlejší
           if (i === 0) {
               ctx.fillStyle = '#5CB728';
           } else {
               ctx.fillStyle = '#4A9A20';
           }

           ctx.fillRect(segment.x * gridSize + 2, segment.y * gridSize + 2, gridSize - 4, gridSize - 4);
       }

       // Vykreslení jídla
       ctx.fillStyle = '#FF5D00';
       ctx.beginPath();
       ctx.arc(
           food.x * gridSize + gridSize / 2,
           food.y * gridSize + gridSize / 2,
           gridSize / 2 - 2,
           0,
           2 * Math.PI
       );
       ctx.fill();
   }

   // Pohyb hada
   function move() {
       if (inputQueue.length > 0) {
           const nextDirection = inputQueue.shift();
           applyDirectionChange(nextDirection);
       }

       const head = {
           x: snake[0].x + dx,
           y: snake[0].y + dy
       };

       // Průchod skrz zdi (wrap around)
       if (head.x < 0) {
           head.x = tileCount - 1; // Levá stěna → pravá strana
       }
       if (head.x >= tileCount) {
           head.x = 0; // Pravá stěna → levá strana
       }
       if (head.y < 0) {
           head.y = tileCount - 1; // Horní stěna → dolní strana
       }
       if (head.y >= tileCount) {
           head.y = 0; // Dolní stěna → horní strana
       }
       // Kontrola kolize se sebou
       for (let segment of snake) {
           if (head.x === segment.x && head.y === segment.y) {
               gameOver();
               return;
           }
       }

       snake.unshift(head);

       // Kontrola, zda had snědl jídlo
       if (head.x === food.x && head.y === food.y) {
           score += 10;
           scoreElement.textContent = score;
           generateFood();
       } else {
           snake.pop();
       }
   }

   // Konec hry
   function gameOver() {
       gameRunning = false;
       finalScoreElement.textContent = score;
       gameOverElement.style.display = 'block';
   }

   // Restart hry
   function restartGame() {
       snake = [{
           x: Math.floor(tileCount / 2),
           y: Math.floor(tileCount / 2)
       }];
       dx = 1; // Začne se pohybovat doprava
       dy = 0;
       score = 0;
       scoreElement.textContent = score;
       gameRunning = true;
       gameStarted = true;
       gameOverElement.style.display = 'none';
       startOverlayElement.style.display = 'none';
       inputQueue = []; // Vyčisti frontu příkazů
       generateFood();
       draw();
       gameLoop(); // Rovnou spustí hru
   }


   // Změna směru
   // Aplikuje změnu směru (pomocná funkce)
   function applyDirectionChange(direction) {
       switch (direction) {
           case 'up':
               if (dy === 0) {
                   dx = 0;
                   dy = -1;
               }
               break;
           case 'down':
               if (dy === 0) {
                   dx = 0;
                   dy = 1;
               }
               break;
           case 'left':
               if (dx === 0) {
                   dx = -1;
                   dy = 0;
               }
               break;
           case 'right':
               if (dx === 0) {
                   dx = 1;
                   dy = 0;
               }
               break;
       }
   }

   function changeDirection(direction) {
       if (!gameStarted) {
           gameStarted = true;
           gameRunning = true;
           startOverlayElement.style.display = 'none';
           applyDirectionChange(direction);
           gameLoop();
           return;
       }

       if (!gameRunning) return;

       // Přidej příkaz do fronty (max 2 příkazy)
       if (inputQueue.length < 2) {
           inputQueue.push(direction);
       }
   }
   // Spuštění hry na mobilním zařízení
   function startGameMobile() {
       changeDirection('right'); // Spustí hru směrem doprava
   }

   // Detekce dotyku
   function handleTouchStart(e) {
       e.preventDefault();
       const touch = e.touches[0];
       const rect = canvas.getBoundingClientRect();
       touchStartX = touch.clientX - rect.left;
       touchStartY = touch.clientY - rect.top;
   }

   function handleTouchMove(e) {
       e.preventDefault();
   }

   function handleTouchEnd(e) {
       e.preventDefault();
       const touch = e.changedTouches[0];
       const rect = canvas.getBoundingClientRect();
       touchEndX = touch.clientX - rect.left;
       touchEndY = touch.clientY - rect.top;

       handleSwipe();
   }

   function handleSwipe() {
       const deltaX = touchEndX - touchStartX;
       const deltaY = touchEndY - touchStartY;

       // Kontrola minimální vzdálenosti
       if (Math.abs(deltaX) < minSwipeDistance && Math.abs(deltaY) < minSwipeDistance) {
           return;
       }

       // Určení směru podle největší změny
       if (Math.abs(deltaX) > Math.abs(deltaY)) {
           // Horizontální pohyb
           if (deltaX > 0) {
               changeDirection('right');
           } else {
               changeDirection('left');
           }
       } else {
           // Vertikální pohyb
           if (deltaY > 0) {
               changeDirection('down');
           } else {
               changeDirection('up');
           }
       }
   }
   // Ovládání klávesnicí
   document.addEventListener('keydown', (e) => {
       if (!gameRunning && e.code === 'Space') {
           restartGame();
           return;
       }

       switch (e.code) {
           case 'ArrowUp':
               e.preventDefault();
               changeDirection('up');
               break;
           case 'ArrowDown':
               e.preventDefault();
               changeDirection('down');
               break;
           case 'ArrowLeft':
               e.preventDefault();
               changeDirection('left');
               break;
           case 'ArrowRight':
               e.preventDefault();
               changeDirection('right');
               break;
           case 'Space':
               e.preventDefault();
               if (!gameRunning) restartGame();
               break;
       }
   });

   // Přidání event listenerů pro dotykové ovládání
   canvas.addEventListener('touchstart', handleTouchStart, {
       passive: false
   });
   canvas.addEventListener('touchmove', handleTouchMove, {
       passive: false
   });
   canvas.addEventListener('touchend', handleTouchEnd, {
       passive: false
   });

   // Hlavní herní smyčka
   function gameLoop() {
       if (gameRunning) {
           move();
       }
       draw();

       if (gameRunning) {
           setTimeout(gameLoop, 250); // Rychlost hry
       }
   }

   // Spuštění hry
   init();
    </script>
